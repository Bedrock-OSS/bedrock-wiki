import{_ as r,c as a,a as i,P as s,U as n,r as c,o as d,b as e,T as t}from"./chunks/framework.Cgdv9yye.js";const w=JSON.parse('{"title":"RakNet and MCPE","description":"RakNet protocol for MCBE.","frontmatter":{"title":"RakNet and MCPE","mentions":["ZestiiSpaghett","MedicalJewel105","SmokeyStack","ThomasOrs","Adrian8115","ismaileke","Tom-Teclador"],"description":"RakNet protocol for MCBE."},"headers":[],"relativePath":"servers/raknet-and-mcpe.md","filePath":"servers/raknet-and-mcpe.md","lastUpdated":1723244200000}'),l={name:"servers/raknet-and-mcpe.md"},h=n('<p>Minecraft Bedrock uses a protocol known as <a href="http://www.jenkinssoftware.com/" target="_blank" rel="noreferrer">RakNet</a> Unlike Minecraft Java edition, Bedrock uses UDP on the port 19132</p><p>You can find a list of Minecraft Bedrock server softwares <a href="/servers/server-software.html#active-software">here</a>.</p><h2 id="raknet-notes" tabindex="-1">RakNet Notes <a class="header-anchor" href="#raknet-notes" aria-label="Permalink to &quot;RakNet Notes&quot;">​</a></h2><ul><li>All strings are prefixed with an unsigned short depicting their length.</li><li>The offline message id will always be: 00ffff00fefefefefdfdfdfd12345678 (hex) - this series of bytes will be referred to as <em>Magic</em></li><li>The offline message id is sent with unconnected messages such as unconnected pings and pongs.</li><li>The GUIDS used by RakNet are 8 bytes long.</li><li>The first byte is used to identify the type of message.</li></ul><h2 id="data-types" tabindex="-1">Data Types <a class="header-anchor" href="#data-types" aria-label="Permalink to &quot;Data Types&quot;">​</a></h2><table><thead><tr><th>Type</th><th>Size</th><th>Range</th><th>Notes</th></tr></thead><tbody><tr><td>Byte</td><td>1</td><td>0-255</td><td>An unsigned integer</td></tr><tr><td>Long</td><td>8</td><td>-2^63 to 2^63-1</td><td>Signed 64 bit integer</td></tr><tr><td>Magic</td><td>16</td><td></td><td>00ffff00fefefefefdfdfdfd12345678 - Will always be those bytes</td></tr><tr><td>Short</td><td>2</td><td>-32768 to 32767</td><td></td></tr><tr><td>Unsigned Short</td><td>2</td><td>0 to 65535</td><td></td></tr><tr><td>String</td><td>N/A</td><td>N/A</td><td>A string prefixed by a short which depicts the length.</td></tr><tr><td>Boolean</td><td>1</td><td>0-1</td><td>0x00 is False while 0x01 is True</td></tr><tr><td>Address</td><td>7</td><td></td><td>1 byte for the ip version 4/6, 4 for the IP and 2 for the port</td></tr><tr><td>uint24le</td><td>3</td><td></td><td>3-byte little-endian unsigned integer</td></tr></tbody></table><h2 id="contents" tabindex="-1">Contents <a class="header-anchor" href="#contents" aria-label="Permalink to &quot;Contents&quot;">​</a></h2>',7),p=e("ul",null,[e("li",null,"[x] Unconnected Pings"),e("li",null,"[x] Unconnected Pongs"),e("li",null,"[x] Open Connection Request 1"),e("li",null,"[x] Open Connection Reply 1"),e("li",null,"[x] Open Connection Request 2"),e("li",null,"[x] Open Connection Reply 2"),e("li",null,[e("strong",null,[t("From here on, the RakNet connection is established and all RakNet messages are contained in a "),e("a",{href:"https://wiki.vg/Raknet_Protocol#Frame_Set_Packet",target:"_blank",rel:"noreferrer"},"Frame Set Packet"),t(".")])]),e("li",null,"[x] Connection Request"),e("li",null,"[x] Connection Request Accepted"),e("li",null,"[x] New Incoming Connection")],-1),u=n('<h3 id="unconnected-pings" tabindex="-1">Unconnected Pings <a class="header-anchor" href="#unconnected-pings" aria-label="Permalink to &quot;Unconnected Pings&quot;">​</a></h3><p>Minecraft Bedrock will send out a message to all listed servers (and the local network) to check if any games are available and retrieve the MOTD from the game. These messages are known as unconnected pings and are structured in this format:</p><p><code>0x01 | client alive time in ms (unsigned long long) | magic | client GUID</code></p><h3 id="unconnected-pongs" tabindex="-1">Unconnected Pongs <a class="header-anchor" href="#unconnected-pongs" aria-label="Permalink to &quot;Unconnected Pongs&quot;">​</a></h3><p>After this message, the server will respond with something called an unconnected pong. The reason these messages are unconnected is because the client has not established a connection to the server. This is the format of an unconnected pong:</p><p><code>0x1c | client alive time in ms (recorded from previous ping) | server GUID | Magic | string length | Edition (MCPE or MCEE for Education Edition);MOTD line 1;Protocol Version;Version Name;Player Count;Max Player Count;Server Unique ID;MOTD line 2;Game mode;Game mode (numeric);Port (IPv4);Port (IPv6);</code></p><p>Example:</p><p><code>MCPE;Dedicated Server;527;1.19.1;0;10;13253860892328930865;Bedrock level;Survival;1;19132;19133;</code></p><p>The client doesn&#39;t seem to use the gamemode or the numeric value for the gamemode.</p><h3 id="open-connection-request-1-→-client→server" tabindex="-1">Open Connection Request 1 |→ Client→Server <a class="header-anchor" href="#open-connection-request-1-→-client→server" aria-label="Permalink to &quot;Open Connection Request 1        |→ Client→Server&quot;">​</a></h3><p>The client sends this when attempting to join the server</p><p><code>0x05 | Magic | Protocol version (currently 11 or 0x0b) | RakNet Null Padding</code></p><p>The null padding seems to be used to discover the maximum packet size the network can handle.</p><p>The client will send this to the server with decreasing null padding until the server responds with a</p><h3 id="open-connection-reply-1-→-server→client" tabindex="-1">Open Connection Reply 1 |→ Server→Client <a class="header-anchor" href="#open-connection-reply-1-→-server→client" aria-label="Permalink to &quot;Open Connection Reply 1        |→ Server→Client&quot;">​</a></h3><p>The server responds with this once the client attempts to join</p><p><code>0x06 | magic | server GUID | ServerHasSecurity (boolean) | Cookie (uint32, if server has security) | MTU Size (Unsigned short)</code></p><p>This is the first half of the handshake between the client and the server.</p><h3 id="open-connection-request-2-→-client→server" tabindex="-1">Open Connection Request 2 |→ Client→Server <a class="header-anchor" href="#open-connection-request-2-→-client→server" aria-label="Permalink to &quot;Open Connection Request 2        |→ Client→Server&quot;">​</a></h3><p>The client responds with this after they receive the open connection reply 1 packet.</p><p><code>0x07 | magic | Cookie (uint32, if server has security) | Client supports security (Boolean(false), always false for the vanilla client, if server has security) | server Address | MTU Size (Unsigned short) | client GUID (Long)</code></p><h3 id="open-connection-reply-2-→-server→client" tabindex="-1">Open Connection Reply 2 |→ Server→Client <a class="header-anchor" href="#open-connection-reply-2-→-server→client" aria-label="Permalink to &quot;Open Connection Reply 2        |→ Server→Client&quot;">​</a></h3><p>This is the last part of the handshake between the client and the server.</p><p><code>0x08 | magic | server GUID (Long) | client Address | MTU Size | security(Boolean)</code></p><p><strong>From here on, all RakNet messages are contained in a <a href="https://wiki.vg/Raknet_Protocol#Frame_Set_Packet" target="_blank" rel="noreferrer">Frame Set Packet</a>.</strong></p><h3 id="connection-request-→-client→server" tabindex="-1">Connection Request |→ Client→Server <a class="header-anchor" href="#connection-request-→-client→server" aria-label="Permalink to &quot;Connection Request        |→ Client→Server&quot;">​</a></h3><p>This is the part where the client sends the connection request.</p><p><code>0x09 | client GUID (Long) | Request timestamp (Long) | Secure (Boolean)</code></p><h3 id="connection-request-accepted-→-server→client" tabindex="-1">Connection Request Accepted |→ Server→Client <a class="header-anchor" href="#connection-request-accepted-→-server→client" aria-label="Permalink to &quot;Connection Request Accepted        |→ Server→Client&quot;">​</a></h3><p>The server sends this packet in response to the incoming connection request.</p><p><code>0x10 | client Address | System index (Short, unknown what this does. 0 works as a value (Minecraft client sends 47)) | System adresses ([]Address) | Ping time (Long) | Pong Time (Long)</code></p><h3 id="new-incoming-connection-→-client→server" tabindex="-1">New Incoming Connection |→ Client→Server <a class="header-anchor" href="#new-incoming-connection-→-client→server" aria-label="Permalink to &quot;New Incoming Connection        |→ Client→Server&quot;">​</a></h3><p>Our RakNet connection is now fully successful.</p><p><code>0x13 | server Address | internal Adress ([20(maybe 10)]Address) (i use 255.255.255.255:0) | Ping time (Long) | Pong Time (Long)</code></p><h3 id="note" tabindex="-1">Note: <a class="header-anchor" href="#note" aria-label="Permalink to &quot;Note:&quot;">​</a></h3><p>The next 2 packets ( and the first Minecraft Protocoll packet) are all send together as one by the vanilla client. The RakNetProtocoll allows for them to be sent seperately too, however servers with a custom raknet implementation might not always handle this case because this never occurs within the vanilly client.</p><h3 id="new-incomming-connection" tabindex="-1">New Incomming Connection <a class="header-anchor" href="#new-incomming-connection" aria-label="Permalink to &quot;New Incomming Connection&quot;">​</a></h3><p>The client sends this packet in response to Connection Request Accepted.</p><p><code>0x13 | serverAddress (uint8) | clientMachineAddresses (address[10], Minecraft sends only one ipv6 together with a placeholder (see below) instead of the other 9) | clientSendTime (uint64) | serverSendTime (uint64)</code></p><p>placehodler for the other clientMachineAddresses (a.k.a. Internal Adresses):</p><blockquote><p>0xd4 0x0b 0xa7 0x86 0xdd 0x98 0x33 0x00 0x00 each byte replaces one of the 9 missing clientMachineAdresses</p></blockquote><p>After having sent this packet, you must periodically sent a Connected Ping to keep the connection alive. The server also sometimes sends a Connected Ping, respond with a Connected Pong.</p><h3 id="connected-ping" tabindex="-1">Connected Ping <a class="header-anchor" href="#connected-ping" aria-label="Permalink to &quot;Connected Ping&quot;">​</a></h3><p>The client sends this packet immeadiatly after/with New Incomming Connection. This packet should be sent as unreliable. The client/server will respond to this with a Connected Pong.</p><p><code>0x00 | Time since start (uint64)</code></p><h3 id="connected-pong" tabindex="-1">Connected Pong <a class="header-anchor" href="#connected-pong" aria-label="Permalink to &quot;Connected Pong&quot;">​</a></h3><p>The client or server sends this packet after having received a Connected Ping. This packet should be sent as unreliable.</p><p><code>0x00 | Time since start client (uint64) | Time since start server (uint64)</code></p><h2 id="sources" tabindex="-1">Sources <a class="header-anchor" href="#sources" aria-label="Permalink to &quot;Sources&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If you are interested and want to read more about it here is the documentation for the Bedrock Protocol and RakNet:</p><p><a href="https://github.com/Mojang/bedrock-protocol-docs" target="_blank" rel="noreferrer">Mojang&#39;s Official Protocol Documentation</a></p><p><a href="https://wiki.vg/Raknet_Protocol" target="_blank" rel="noreferrer">RakNet Protocol Documentation</a></p><p><a href="https://github.com/vp817/RakNetProtocolDoc" target="_blank" rel="noreferrer">another RakNet Protocol Documentation</a></p></div><p>This page is a WIP, feel free to contribute as it is still being worked on.</p>',51);function m(g,f,k,v,b,P){const o=c("Checklist");return d(),a("div",null,[h,i(o,null,{default:s(()=>[p]),_:1}),u])}const x=r(l,[["render",m]]);export{w as __pageData,x as default};
