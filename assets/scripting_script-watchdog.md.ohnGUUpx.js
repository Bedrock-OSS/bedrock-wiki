import{_ as i,e as n,t,C as r,f as e,E as s,Q as l,D as c,d as o}from"./chunks/framework.CuLWBCQE.js";const x=JSON.parse(`{"title":"Script Watchdog","description":"Watchdog is a performance system for script engine that is enabled in Minecraft script plugins by default.","frontmatter":{"title":"Script Watchdog","category":"Documentation","tags":["experimental"],"mentions":["JaylyDev","SmokeyStack","ThomasOrs"],"description":"Watchdog is a performance system for script engine that is enabled in Minecraft script plugins by default."},"headers":[{"level":2,"title":"Watchdog Configuration","slug":"watchdog-configuration","link":"#watchdog-configuration","children":[]},{"level":2,"title":"Watchdog Messages","slug":"watchdog-messages","link":"#watchdog-messages","children":[{"level":3,"title":"Slow-running script detected in behavior pack '%s' (x ms average)","slug":"slow-running-script-detected-in-behavior-pack-s-x-ms-average","link":"#slow-running-script-detected-in-behavior-pack-s-x-ms-average","children":[]},{"level":3,"title":"x ms script spike detected in behavior pack '%s'","slug":"x-ms-script-spike-detected-in-behavior-pack-s","link":"#x-ms-script-spike-detected-in-behavior-pack-s","children":[]},{"level":3,"title":"Out of memory exception detected in behavior pack '%s'","slug":"out-of-memory-exception-detected-in-behavior-pack-s","link":"#out-of-memory-exception-detected-in-behavior-pack-s","children":[]},{"level":3,"title":"x ms script hang detected in behavior pack '%s'","slug":"x-ms-script-hang-detected-in-behavior-pack-s","link":"#x-ms-script-hang-detected-in-behavior-pack-s","children":[]},{"level":3,"title":"Stack overflow detected in behavior pack '%s'","slug":"stack-overflow-detected-in-behavior-pack-s","link":"#stack-overflow-detected-in-behavior-pack-s","children":[]},{"level":3,"title":"High memory usage detected","slug":"high-memory-usage-detected","link":"#high-memory-usage-detected","children":[]},{"level":3,"title":"Unhandled critical exception of type '%s' in behavior pack '%s'","slug":"unhandled-critical-exception-of-type-s-in-behavior-pack-s","link":"#unhandled-critical-exception-of-type-s-in-behavior-pack-s","children":[]}]},{"level":2,"title":"Cancel Watchdog Termination","slug":"cancel-watchdog-termination","link":"#cancel-watchdog-termination","children":[]},{"level":2,"title":"Watchdog Commands","slug":"watchdog-commands","link":"#watchdog-commands","children":[]}],"relativePath":"scripting/script-watchdog.md","filePath":"scripting/script-watchdog.md"}`),h={name:"scripting/script-watchdog.md"},p=e("p",null,"Watchdog is a performance system for script engine that is enabled in Minecraft script plugins by default.",-1),d=e("h2",{id:"watchdog-configuration",tabindex:"-1"},[s("Watchdog Configuration "),e("a",{class:"header-anchor",href:"#watchdog-configuration","aria-label":'Permalink to "Watchdog Configuration"'},"​")],-1),k=e("p",null,[s("There is a set of watchdog configuration that governs the performance of the script environment since 1.19.20. These options cannot be modified in world or realms, but they can be modified via "),e("code",null,"server.properties"),s(" in "),e("a",{href:"https://www.minecraft.net/en-us/download/server/bedrock",target:"_blank",rel:"noreferrer"},"Dedicated Server"),s(". Below is default watchdog settings, which are the same on all devices for world and realms.")],-1),g=l(`<div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enables the watchdog (default = true)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">script-watchdog-enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sets the watchdog threshold for single tick hangs (default = 3000 ms)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">script-watchdog-hang-threshold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=3000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sets the watchdog threshold for single tick spikes (default = 100 ms)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">script-watchdog-spike-threshold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sets the watchdog threshold for slow scripts over multiple ticks (default = 2ms)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">script-watchdog-slow-threshold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Saves and shuts down the world when the combined memory usage exceeds the given threshold (in megabytes).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Setting this value to 0 disables the limit. (default = 250)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">script-watchdog-memory-limit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=250</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Produces a content log warning when the combined memory usage exceeds the given threshold (in megabytes).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Setting this value to 0 disables the warning. (default = 100)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">script-watchdog-memory-warning</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enables watchdog exception handling via the events.beforeWatchdogTerminate event (default = true)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">script-watchdog-enable-exception-handling</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enables server shutdown in the case of an unhandled watchdog exception (default = true)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">script-watchdog-enable-shutdown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Throws a critical exception when a hang occurs (default = true)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">script-watchdog-hang-exception</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="watchdog-messages" tabindex="-1">Watchdog Messages <a class="header-anchor" href="#watchdog-messages" aria-label="Permalink to &quot;Watchdog Messages&quot;">​</a></h2><p>These watchdog messages are thrown with <code>[Watchdog]</code> label in error or warning. They&#39;re displayed in a warning or an error. These error should never be ignored.</p><h3 id="slow-running-script-detected-in-behavior-pack-s-x-ms-average" tabindex="-1">Slow-running script detected in behavior pack &#39;%s&#39; (x ms average) <a class="header-anchor" href="#slow-running-script-detected-in-behavior-pack-s-x-ms-average" aria-label="Permalink to &quot;Slow-running script detected in behavior pack &#39;%s&#39; (x ms average)&quot;">​</a></h3><p>Script runtime is delayed by over a certain timeframe.</p><h3 id="x-ms-script-spike-detected-in-behavior-pack-s" tabindex="-1">x ms script spike detected in behavior pack &#39;%s&#39; <a class="header-anchor" href="#x-ms-script-spike-detected-in-behavior-pack-s" aria-label="Permalink to &quot;x ms script spike detected in behavior pack &#39;%s&#39;&quot;">​</a></h3><p>There is a spike in script runtime.</p><h3 id="out-of-memory-exception-detected-in-behavior-pack-s" tabindex="-1">Out of memory exception detected in behavior pack &#39;%s&#39; <a class="header-anchor" href="#out-of-memory-exception-detected-in-behavior-pack-s" aria-label="Permalink to &quot;Out of memory exception detected in behavior pack &#39;%s&#39;&quot;">​</a></h3><p>This error occurs when the combined memory usage exceeds.</p><p>This saves and shuts down the world by Watchdog termination and cannot be canceled using <code>BeforeWatchdogTerminateEvent</code>.</p><h3 id="x-ms-script-hang-detected-in-behavior-pack-s" tabindex="-1">x ms script hang detected in behavior pack &#39;%s&#39; <a class="header-anchor" href="#x-ms-script-hang-detected-in-behavior-pack-s" aria-label="Permalink to &quot;x ms script hang detected in behavior pack &#39;%s&#39;&quot;">​</a></h3><p>The scripts freezes at a certain location of your script for more than the watchdog threshold for single tick.</p><p>This is usually caused by iteration, such as <code>while</code> loop and <code>for</code> loop.</p><h3 id="stack-overflow-detected-in-behavior-pack-s" tabindex="-1">Stack overflow detected in behavior pack &#39;%s&#39; <a class="header-anchor" href="#stack-overflow-detected-in-behavior-pack-s" aria-label="Permalink to &quot;Stack overflow detected in behavior pack &#39;%s&#39;&quot;">​</a></h3><p>Occurs when there is a recursive function (a function that calls itself) without an exit point.</p><h3 id="high-memory-usage-detected" tabindex="-1">High memory usage detected <a class="header-anchor" href="#high-memory-usage-detected" aria-label="Permalink to &quot;High memory usage detected&quot;">​</a></h3><p>Produces a content log warning when the combined memory usage exceeds the given threshold in megabytes.</p><h3 id="unhandled-critical-exception-of-type-s-in-behavior-pack-s" tabindex="-1">Unhandled critical exception of type &#39;%s&#39; in behavior pack &#39;%s&#39; <a class="header-anchor" href="#unhandled-critical-exception-of-type-s-in-behavior-pack-s" aria-label="Permalink to &quot;Unhandled critical exception of type &#39;%s&#39; in behavior pack &#39;%s&#39;&quot;">​</a></h3><p>Produces a content log error when an unhandled critical exception occurs.</p><p>There are multiple reasons that a watchdog is deciding to terminate execution of a behavior pack&#39;s script.</p><ul><li><code>hang</code>: script is not responsive due to a hang or infinite loop.</li><li><code>stackOverflow</code>: a long, and potentially infinite chain of function calls.</li></ul><h2 id="cancel-watchdog-termination" tabindex="-1">Cancel Watchdog Termination <a class="header-anchor" href="#cancel-watchdog-termination" aria-label="Permalink to &quot;Cancel Watchdog Termination&quot;">​</a></h2><p>Using Minecraft&#39;s scripting API, you are able to connect to a callback that will be called when a script runtime is being terminated due to a violation of the performance watchdog system.</p><p>This event allows you to cancel the termination of the script runtime to prevent from the watchdog from stopping the server from running. Note that depending on server configuration settings, cancellation of the termination may not be allowed.</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { system } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@minecraft/server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system.events.beforeWatchdogTerminate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  event.cancel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`[Watchdog] Canceled critical exception of type &#39;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">event</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cancelationReason</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="watchdog-commands" tabindex="-1">Watchdog Commands <a class="header-anchor" href="#watchdog-commands" aria-label="Permalink to &quot;Watchdog Commands&quot;">​</a></h2><p>Watchdog implementation comes with Minecraft&#39;s slash commands, which can be used with the <code>/script watchdog</code> command.</p><ul><li><code>/script watchdog exportstats</code>: Exports performance profiling of scripting environment, this includes plugin handles and runtime information.</li></ul><hr><p><a href="https://github.com/JaylyDev/ScriptAPI/blob/main/docs/MinecraftApi/Watchdog.md" target="_blank" rel="noreferrer">Original Credit</a></p>`,30);function m(u,b,v,f,y,E){const a=c("CodeHeader");return o(),n("div",null,[p,d,k,t(a,null,{default:r(()=>[s("bedrock-server/server.properties")]),_:1}),g])}const A=i(h,[["render",m]]);export{x as __pageData,A as default};
